{% load static %}

<script type="text/javascript" src="{% static 'js/cookie.js' %}"></script>
<script type="text/javascript" src="{% static 'js/axios.js' %}"></script>
<script type="text/javascript" src="{% static 'js/jquery-3.3.1.min.js' %}"></script>
<script type="text/javascript" src="{% static 'js/fb.js' %}"></script>
<script type="text/javascript" src="{% static 'js/init-user-info.js' %}"></script>
<script>
    initUserInfo();

    function facebookLogin() {
      FB.getLoginStatus(function(response) {
        var accessToken;
        if (response.status != 'connected') {
          FB.login(function(response) {
            accessToken = response.authResponse.accessToken
            console.log(accessToken)
            getFacebookUser(accessToken)
          });
        }else{
          accessToken = response.authResponse.accessToken
          getFacebookUser(accessToken)
        }
      });
    }

    function getFacebookUser(access_token) {
      axios({
        url: 'http://localhost:8000/api/members/login/',
        method: 'post',
        data: {
          access_token: access_token,
        }
      }).then(function(response) {
        console.log(response.data)
        var token = response.data.token
        var user = response.data.user
        setCookie('token', token, 7);
        setUserInfo(user)
      }).catch(function(error) {
        console.log(error.response);
      });
    }

    $('#btn-facebook').click(function() {
      facebookLogin();
    })


</script>